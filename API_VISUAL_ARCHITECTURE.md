# CRM-AI-PRO API Visual Architecture

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CRM-AI-PRO API SYSTEM                            â”‚
â”‚                         158 Total Endpoints                              â”‚
â”‚                    Running on Next.js 15 + Supabase                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend (Next.js)   â”‚
â”‚    Port: 3000/3002     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              API Routes (/app/api/*)                       â”‚
â”‚              Middleware: Auth, CORS, Rate Limiting          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼             â–¼             â–¼              â–¼             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Auth  â”‚   â”‚ Contact â”‚   â”‚   Job   â”‚   â”‚Financial â”‚  â”‚Analytics â”‚
    â”‚        â”‚   â”‚  Mgmt   â”‚   â”‚  Mgmt   â”‚   â”‚  Mgmt    â”‚  â”‚          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Core Service Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AUTHENTICATION LAYER                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Supabase Auth JWT Verification                                        â”‚
â”‚ â€¢ Role-Based Access Control (RBAC)                                      â”‚
â”‚ â€¢ Session Management                                                     â”‚
â”‚                                                                          â”‚
â”‚ Roles: owner, admin, dispatcher, tech, sales                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          API ENDPOINT LAYER                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CONTACT SERVICES   â”‚    JOB SERVICES      â”‚   FINANCIAL SERVICES     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      â”‚                      â”‚                          â”‚
â”‚ âœ… GET    /contacts  â”‚ âœ… GET    /jobs      â”‚ âœ… GET    /estimates     â”‚
â”‚ âœ… POST   /contacts  â”‚ âœ… POST   /jobs      â”‚ âœ… POST   /estimates     â”‚
â”‚ âœ… GET    /contacts/ â”‚ âœ… GET    /jobs/[id] â”‚ âœ… GET    /estimates/[id]â”‚
â”‚          [id]        â”‚ âœ… PUT    /jobs/[id] â”‚ âš ï¸  GET    /invoices     â”‚
â”‚ âœ… PUT    /contacts/ â”‚ âœ… DELETE /jobs/[id] â”‚ âš ï¸  GET    /payments     â”‚
â”‚          [id]        â”‚                      â”‚ âœ… GET    /parts         â”‚
â”‚ âœ… DELETE /contacts/ â”‚ Status Updates:      â”‚ âœ… GET    /parts/        â”‚
â”‚          [id]        â”‚ âœ… PATCH  /jobs/[id] â”‚          low-stock       â”‚
â”‚                      â”‚          /status     â”‚                          â”‚
â”‚ Bulk Operations:     â”‚                      â”‚ PDF Generation:          â”‚
â”‚ âœ… POST   /contacts/ â”‚ Assignment:          â”‚ âœ… GET    /estimates/    â”‚
â”‚          bulk        â”‚ âœ… POST   /jobs/[id] â”‚          [id]/pdf        â”‚
â”‚ âœ… POST   /contacts/ â”‚          /assign     â”‚                          â”‚
â”‚          bulk-tag    â”‚                      â”‚ Conversion:              â”‚
â”‚                      â”‚ Location:            â”‚ âœ… POST   /estimates/    â”‚
â”‚ Tags:                â”‚ âœ… PUT    /jobs/[id] â”‚          [id]/convert    â”‚
â”‚ âœ… GET    /contact-  â”‚          /location   â”‚                          â”‚
â”‚          tags        â”‚                      â”‚                          â”‚
â”‚ âœ… POST   /contact-  â”‚ Photos:              â”‚                          â”‚
â”‚          tags        â”‚ âš ï¸  GET    /job-     â”‚                          â”‚
â”‚                      â”‚          photos      â”‚                          â”‚
â”‚ Notes:               â”‚ âš ï¸  POST   /job-     â”‚                          â”‚
â”‚ âœ… GET    /contacts/ â”‚          photos      â”‚                          â”‚
â”‚          [id]/notes  â”‚                      â”‚                          â”‚
â”‚ âœ… POST   /contacts/ â”‚ Materials:           â”‚                          â”‚
â”‚          [id]/notes  â”‚ âš ï¸  GET    /job-     â”‚                          â”‚
â”‚                      â”‚          materials   â”‚                          â”‚
â”‚                      â”‚ âš ï¸  POST   /job-     â”‚                          â”‚
â”‚                      â”‚          materials   â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  COMMUNICATION SVCs  â”‚  ANALYTICS SERVICES  â”‚   AUTOMATION SERVICES    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      â”‚                      â”‚                          â”‚
â”‚ Conversations:       â”‚ Dashboard:           â”‚ Rules:                   â”‚
â”‚ âœ… GET    /          â”‚ âœ… GET    /analytics/â”‚ âš ï¸  GET    /automation-  â”‚
â”‚    conversations     â”‚          dashboard   â”‚          rules           â”‚
â”‚ âœ… POST   /          â”‚                      â”‚ âœ… POST   /automation-   â”‚
â”‚    conversations     â”‚ Jobs Analytics:      â”‚          rules           â”‚
â”‚                      â”‚ âœ… GET    /analytics/â”‚                          â”‚
â”‚ Messages:            â”‚          jobs        â”‚ âš ï¸  GET    /settings/    â”‚
â”‚ âœ… GET    /          â”‚                      â”‚          automation/     â”‚
â”‚    conversations/    â”‚ Revenue:             â”‚          rules           â”‚
â”‚    [id]/messages     â”‚ âŒ GET    /analytics/â”‚                          â”‚
â”‚ âœ… POST   /          â”‚          revenue     â”‚ AI Suggestions:          â”‚
â”‚    conversations/    â”‚          (BROKEN)    â”‚ âœ… POST   /ai/           â”‚
â”‚    [id]/messages     â”‚                      â”‚          suggestions     â”‚
â”‚                      â”‚ Contacts:            â”‚                          â”‚
â”‚ Email Templates:     â”‚ âœ… GET    /analytics/â”‚ AI Draft:                â”‚
â”‚ âœ… GET    /email-    â”‚          contacts    â”‚ âœ… POST   /ai/draft      â”‚
â”‚    templates         â”‚                      â”‚                          â”‚
â”‚ âœ… POST   /email-    â”‚ Reports:             â”‚ AI Pricing:              â”‚
â”‚    templates         â”‚ âš ï¸  GET    /reports  â”‚ âœ… POST   /ai/pricing    â”‚
â”‚                      â”‚          (needs      â”‚                          â”‚
â”‚ Campaigns:           â”‚          params)     â”‚                          â”‚
â”‚ âœ… GET    /campaigns â”‚                      â”‚                          â”‚
â”‚ âœ… POST   /campaigns â”‚ Finance Stats:       â”‚                          â”‚
â”‚                      â”‚ âœ… GET    /finance/  â”‚                          â”‚
â”‚ Call Logs:           â”‚          stats       â”‚                          â”‚
â”‚ âœ… GET    /call-logs â”‚                      â”‚                          â”‚
â”‚ âœ… POST   /call-logs â”‚                      â”‚                          â”‚
â”‚                      â”‚                      â”‚                          â”‚
â”‚ Notifications:       â”‚                      â”‚                          â”‚
â”‚ âœ… GET    /          â”‚                      â”‚                          â”‚
â”‚    notifications     â”‚                      â”‚                          â”‚
â”‚ âœ… POST   /          â”‚                      â”‚                          â”‚
â”‚    notifications     â”‚                      â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DISPATCH SERVICES   â”‚   TECH PORTAL        â”‚   OFFICE/OWNER PORTAL    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      â”‚                      â”‚                          â”‚
â”‚ Active Jobs:         â”‚ Tech Jobs:           â”‚ Clearances:              â”‚
â”‚ âœ… GET    /dispatch/ â”‚ âœ… GET    /tech/jobs â”‚ âœ… GET    /office/       â”‚
â”‚    jobs/active       â”‚ âœ… GET    /tech/     â”‚          clearances      â”‚
â”‚                      â”‚          jobs/[id]   â”‚ âœ… POST   /office/       â”‚
â”‚ Auto-Assign:         â”‚                      â”‚          clearances      â”‚
â”‚ âœ… POST   /dispatch/ â”‚ Status Updates:      â”‚                          â”‚
â”‚    auto-assign       â”‚ âœ… POST   /tech/     â”‚ Office Stats:            â”‚
â”‚                      â”‚          jobs/[id]/  â”‚ âœ… GET    /office/stats  â”‚
â”‚ Technicians:         â”‚          status      â”‚                          â”‚
â”‚ âœ… GET    /dispatch/ â”‚                      â”‚ Owner Stats:             â”‚
â”‚    techs             â”‚ Gate Codes:          â”‚ âœ… GET    /owner/stats   â”‚
â”‚ âœ… GET    /dispatch/ â”‚ âš ï¸  GET    /tech/    â”‚                          â”‚
â”‚    techs/[id]/stats  â”‚          gates       â”‚                          â”‚
â”‚ âœ… GET    /dispatch/ â”‚          (405)       â”‚                          â”‚
â”‚    techs/[id]/       â”‚                      â”‚                          â”‚
â”‚    activity          â”‚ Quick Add Material:  â”‚                          â”‚
â”‚                      â”‚ âœ… POST   /tech/     â”‚                          â”‚
â”‚ Stats:               â”‚          materials/  â”‚                          â”‚
â”‚ âœ… GET    /dispatch/ â”‚          quick-add   â”‚                          â”‚
â”‚    stats             â”‚                      â”‚                          â”‚
â”‚                      â”‚ Time Clock:          â”‚                          â”‚
â”‚ GPS Tracking:        â”‚ âœ… POST   /tech/     â”‚                          â”‚
â”‚ âœ… GET    /dispatch/ â”‚          time-clock  â”‚                          â”‚
â”‚    historical-gps    â”‚                      â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Integration Services

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         EXTERNAL INTEGRATIONS                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   EMAIL SERVICES      â•‘  â•‘   CALENDAR SERVICES   â•‘  â•‘   AI/LLM SERVICES â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                       â•‘  â•‘                       â•‘  â•‘                   â•‘
â•‘ Gmail Integration:    â•‘  â•‘ Google Calendar:      â•‘  â•‘ LLM Providers:    â•‘
â•‘ âœ… /integrations/     â•‘  â•‘ âœ… /calendar/events   â•‘  â•‘ âš ï¸  OpenAI        â•‘
â•‘    gmail/status       â•‘  â•‘    (9.5s - SLOW)      â•‘  â•‘     GPT-4o        â•‘
â•‘ âœ… /integrations/     â•‘  â•‘                       â•‘  â•‘ âš ï¸  OpenAI        â•‘
â•‘    gmail/authorize    â•‘  â•‘ âœ… /calendar/sync     â•‘  â•‘     GPT-4o Mini   â•‘
â•‘ âœ… /integrations/     â•‘  â•‘                       â•‘  â•‘ âš ï¸  Anthropic     â•‘
â•‘    gmail/callback     â•‘  â•‘ âœ… /integrations/     â•‘  â•‘     Claude 4.5    â•‘
â•‘ âœ… /integrations/     â•‘  â•‘    calendar/google/   â•‘  â•‘ âš ï¸  Anthropic     â•‘
â•‘    gmail/sync         â•‘  â•‘    authorize          â•‘  â•‘     Haiku 4.5     â•‘
â•‘ âœ… /integrations/     â•‘  â•‘                       â•‘  â•‘                   â•‘
â•‘    gmail/send         â•‘  â•‘ Optimization:         â•‘  â•‘ Health Check:     â•‘
â•‘                       â•‘  â•‘ âœ… /schedule/optimize â•‘  â•‘ âš ï¸  /llm/health   â•‘
â•‘ Microsoft Integration:â•‘  â•‘                       â•‘  â•‘    (503 - Down)   â•‘
â•‘ âœ… /integrations/     â•‘  â•‘                       â•‘  â•‘                   â•‘
â•‘    microsoft/status   â•‘  â•‘                       â•‘  â•‘ Router:           â•‘
â•‘ âœ… /integrations/     â•‘  â•‘                       â•‘  â•‘ âœ… /llm (POST)    â•‘
â•‘    microsoft/         â•‘  â•‘                       â•‘  â•‘                   â•‘
â•‘    authorize          â•‘  â•‘                       â•‘  â•‘ Metrics:          â•‘
â•‘ âœ… /integrations/     â•‘  â•‘                       â•‘  â•‘ âœ… /llm/metrics   â•‘
â•‘    microsoft/         â•‘  â•‘                       â•‘  â•‘                   â•‘
â•‘    callback           â•‘  â•‘                       â•‘  â•‘ Providers:        â•‘
â•‘ âœ… /integrations/     â•‘  â•‘                       â•‘  â•‘ âš ï¸  /llm-providersâ•‘
â•‘    microsoft/sync     â•‘  â•‘                       â•‘  â•‘    (403)          â•‘
â•‘                       â•‘  â•‘                       â•‘  â•‘                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  PAYMENT SERVICES     â•‘  â•‘   VOICE SERVICES      â•‘  â•‘   MCP SERVICES    â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                       â•‘  â•‘                       â•‘  â•‘                   â•‘
â•‘ Stripe:               â•‘  â•‘ ElevenLabs:           â•‘  â•‘ Model Context:    â•‘
â•‘ âš ï¸  /webhooks/stripe  â•‘  â•‘ âœ… /webhooks/         â•‘  â•‘ âœ… /mcp (POST)    â•‘
â•‘    (untested)         â•‘  â•‘    elevenlabs         â•‘  â•‘                   â•‘
â•‘                       â•‘  â•‘                       â•‘  â•‘                   â•‘
â•‘ Payments:             â•‘  â•‘ Voice Commands:       â•‘  â•‘                   â•‘
â•‘ âš ï¸  /payments (404)   â•‘  â•‘ âœ… /voice-command     â•‘  â•‘                   â•‘
â•‘                       â•‘  â•‘                       â•‘  â•‘                   â•‘
â•‘                       â•‘  â•‘ Meeting AI:           â•‘  â•‘                   â•‘
â•‘                       â•‘  â•‘ âš ï¸  /meetings (400)   â•‘  â•‘                   â•‘
â•‘                       â•‘  â•‘ âœ… /meetings/analyze  â•‘  â•‘                   â•‘
â•‘                       â•‘  â•‘ âœ… /meetings/notes    â•‘  â•‘                   â•‘
â•‘                       â•‘  â•‘                       â•‘  â•‘                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Database Layer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           SUPABASE DATABASE                              â”‚
â”‚                         PostgreSQL + Row Level Security                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   accounts   â”‚    users     â”‚   contacts   â”‚     jobs     â”‚  estimates   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id           â”‚ id           â”‚ id           â”‚ id           â”‚ id           â”‚
â”‚ name         â”‚ account_id   â”‚ account_id   â”‚ account_id   â”‚ account_id   â”‚
â”‚ slug         â”‚ email        â”‚ email        â”‚ contact_id   â”‚ contact_id   â”‚
â”‚ created_at   â”‚ role         â”‚ first_name   â”‚ description  â”‚ amount       â”‚
â”‚              â”‚              â”‚ last_name    â”‚ status       â”‚ status       â”‚
â”‚              â”‚              â”‚ phone        â”‚ priority     â”‚ items        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    parts     â”‚   payments   â”‚  invoices    â”‚conversations â”‚   campaigns  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id           â”‚ id           â”‚ id           â”‚ id           â”‚ id           â”‚
â”‚ account_id   â”‚ account_id   â”‚ account_id   â”‚ account_id   â”‚ account_id   â”‚
â”‚ name         â”‚ amount       â”‚ job_id       â”‚ contact_id   â”‚ name         â”‚
â”‚ sku          â”‚ status       â”‚ amount       â”‚ subject      â”‚ status       â”‚
â”‚ stock_qty    â”‚ created_at   â”‚ status       â”‚ status       â”‚ recipients   â”‚
â”‚ unit_price   â”‚              â”‚ sent_at      â”‚              â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## System Health Dashboard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SYSTEM HEALTH STATUS                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Core Services:          [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 67% Healthy (37/55 tested)
  â”œâ”€ Contact Management  âœ… 100% Operational
  â”œâ”€ Job Management      âœ… 100% Operational
  â”œâ”€ Analytics           âš ï¸  75% (Revenue broken)
  â”œâ”€ Communications      âœ… 100% Operational
  â”œâ”€ Dispatch            âœ… 100% Operational
  â””â”€ Settings            âœ… 100% Operational

Integration Services:   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] 60% Healthy
  â”œâ”€ Gmail               âœ… Connected
  â”œâ”€ Microsoft/Outlook   âœ… Connected
  â”œâ”€ Calendar            âš ï¸  Slow (9.5s response)
  â”œâ”€ LLM Providers       âŒ All unhealthy
  â””â”€ Payments            âš ï¸  Configuration issue

New Features:          [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] 85% Healthy
  â”œâ”€ Estimates Module    âœ… Operational
  â”œâ”€ Parts Inventory     âœ… Operational
  â”œâ”€ Onboarding          âœ… Operational
  â””â”€ Meeting AI          âš ï¸  Partial functionality

Performance:           [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘] 70% Acceptable
  â”œâ”€ Average Response     âš ï¸  550ms
  â”œâ”€ Slowest Endpoint     âŒ 9502ms (calendar/events)
  â””â”€ Failed Requests      âœ… <2%

Security:              [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 95% Excellent
  â”œâ”€ Authentication      âœ… Working
  â”œâ”€ Authorization       âš ï¸  Some RBAC issues
  â””â”€ RLS Policies        âœ… Active
```

---

## Critical Path - User Journey Flows

### 1. Contact â†’ Job â†’ Invoice Flow
```
Customer Call
     â†“
âœ… Create Contact (/api/contacts POST)
     â†“
âœ… Create Job (/api/jobs POST)
     â†“
âœ… Assign Tech (/api/jobs/[id]/assign POST)
     â†“
âœ… Update Status (/api/jobs/[id]/status PATCH)
     â†“
âš ï¸  Create Invoice (/api/invoices POST) - USER LOOKUP ISSUE
     â†“
âš ï¸  Record Payment (/api/payments POST) - USER LOOKUP ISSUE
```

### 2. Estimate â†’ Job Conversion Flow
```
Lead Generation
     â†“
âœ… Create Contact (/api/contacts POST)
     â†“
âœ… Create Estimate (/api/estimates POST)
     â†“
âœ… Send Estimate (/api/estimates/[id]/send POST)
     â†“
Customer Approval
     â†“
âœ… Convert to Job (/api/estimates/[id]/convert POST)
     â†“
âœ… Assign & Schedule (/api/jobs/[id]/assign POST)
```

### 3. Dispatch â†’ Tech Execution Flow
```
âœ… View Active Jobs (/api/dispatch/jobs/active GET)
     â†“
âœ… Auto-Assign Tech (/api/dispatch/auto-assign POST)
     â†“
âœ… Tech Views Jobs (/api/tech/jobs GET)
     â†“
âœ… Tech Updates Status (/api/tech/jobs/[id]/status POST)
     â†“
âš ï¸  Add Materials (/api/job-materials POST) - NEEDS JOBID
     â†“
âš ï¸  Upload Photos (/api/job-photos POST) - NEEDS JOBID
```

---

## Issue Priority Matrix

```
    High Impact   â”‚  âŒ Revenue Analytics      â”‚  âš ï¸  LLM Health           â”‚
                  â”‚     (Complete Failure)     â”‚     (All Providers Down)  â”‚
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                  â”‚  âš ï¸  Invoice/Payment       â”‚  âš ï¸  Calendar Performance â”‚
    Med Impact    â”‚     (User Lookup)          â”‚     (9.5s response)       â”‚
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                  â”‚  âš ï¸  Method Mismatches     â”‚  âš ï¸  RBAC Restrictions    â”‚
    Low Impact    â”‚     (Wrong HTTP verbs)     â”‚     (403 Errors)          â”‚
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       High Frequency              Low Frequency
```

---

## Recommended Testing Priorities

### Phase 1: Critical Fixes (This Week)
1. âŒ Fix revenue analytics endpoint
2. âš ï¸  Configure and health-check LLM providers
3. âš ï¸  Fix invoice/payment user lookup

### Phase 2: Integration Testing (Next Week)
1. Test all POST/PUT/DELETE operations
2. Test file upload endpoints
3. Test webhook endpoints
4. Test real data mutations

### Phase 3: Performance Optimization (Sprint)
1. Optimize calendar events endpoint
2. Add caching layer
3. Implement rate limiting
4. Add database indexes

### Phase 4: Complete Coverage (Month)
1. Test all 158 endpoints
2. Add E2E workflow tests
3. Load testing
4. Security audit

---

**Legend:**
- âœ… Working correctly
- âš ï¸  Working with issues
- âŒ Completely broken
- ğŸ”„ Skipped/Not tested
